import { ApiError } from '../errors';
import { describe } from 'mocha';
import JsonWebToken from './jsonwebtoken';
import assert from 'assert';
import chai from 'chai';

const payload = {
    user_id: '8db0b3b9-a2a2-4085-bea4-c7835f43d23b',
    admin: true,
};

describe('JsonWebToken', () => {
    const jwt = new JsonWebToken<{
        user_id: string;
        admin?: boolean;
    }>();

    const pair = jwt.generateTokensPair(payload);

    it('#publicKey should be a string', () => {
        assert(typeof jwt.publicKey === 'string');
    });

    it('#verifyAccess() should pass when token is generated by #generateTokensPair()', () => {
        chai.should().not.Throw(() => jwt.verifyAccess(pair.access));
    });

    it('#verifyRefresh() should pass when token is generated by #generateTokensPair()', () => {
        assert(jwt.verifyRefresh(pair.refresh));
    });

    it('#verifyAccess() should throw ApiError when token is empty string', () => {
        chai.should().Throw(() => jwt.verifyAccess(''), ApiError)
    })
});
